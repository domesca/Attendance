<!DOCTYPE html>
<html>
<head>
  <title>Warehouse Attendance</title>
  <script>
    async function sendData(action) {
      const name = document.getElementById('name').value;
      if (!name) {
        alert("Please enter your name.");
        return;
      }

      const getIP = async () => {
        try {
          const res = await fetch("https://api.ipify.org?format=json");
          const data = await res.json();
          return data.ip;
        } catch (e) {
          return "Unavailable";
        }
      };

      navigator.geolocation.getCurrentPosition(async (position) => {
        const latitude = position.coords.latitude;
        const longitude = position.coords.longitude;
        const ip = await getIP();

        const formData = new FormData();
        formData.append("name", name);
        formData.append("latitude", latitude);
        formData.append("longitude", longitude);
        formData.append("ip", ip);
        formData.append("action", action);

        fetch("https://script.google.com/macros/s/AKfycbxehRCuFktgbI2s4eDvS5NxqIsuyUm2hCgN236Zz9jeb-Qe8RybnTlmcvdwLXjdWxFqtA/exec", {
          method: "POST",
          body: formData
        })
        .then(res => res.text())
        .then(response => {
          if (response.includes("Success")) {
            alert("Attendance submitted successfully.");
          } else {
            alert("Failed to submit attendance. Please try again.");
            console.error(response);
          }
        })
        .catch(error => {
          alert("Error submitting attendance.");
          console.error("Submission error:", error);
        });
      }, () => {
        alert("Location access denied.");
      });
    }
  </script>
</head>
<body>
  <h2>Warehouse Attendance</h2>
  <label for="name">Name:</label>
  <input type="text" id="name" />
  <br><br>
  <button onclick="sendData('checkin')">Check In</button>
  <button onclick="sendData('checkout')">Check Out</button>
</body>
</html>
